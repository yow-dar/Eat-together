<form id = "img_preview_form" enctype="multipart/form-data">
  <input type = "file" id="img_upload" accept="image/*" autocomplete="off">
  <img style="max-width:60%; max-height:60vw;">
  <button>確認</button>
</form>
<script>
var upload_file;
  $('body').on('change','#img_preview_form input',function(){  
    preview(this);
  });

  $('body').on('click','#img_preview_form button',function(e){  
    e.preventDefault();
    upload(upload_file);
  });

function preview(input){
  if(input.files && input.files[0]){
    upload_file=input;
    var reader = new FileReader();
    reader.onload = function(e){
      $('#img_preview_form img').attr('src',e.target.result);
    }
    reader.readAsDataURL(input.files[0]);        
    
  }
}

function upload(input){
  if(input.files && input.files[0]){
    var formData = new FormData();
    formData.append('file',input.files[0]);
    formData.append('user_id',user_id);
    
    $.ajax({
      url:'/enroll_end',
      type:'post',
      data:formData,
      cache:false,
      contentType:false,
      processData:false,
      success:function(data){
        let res = {
          'user_id': user_id,
          'user_name': user_name,
        }
        res.message_name = 'signin_Home';
        window.parent.postMessage(res,'*');
      }
    });
  }
}
</script>
